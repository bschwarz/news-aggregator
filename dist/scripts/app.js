APP.Main=function(){var o=document.querySelector.bind(document),i=null,a=0,n=100,h=o("main"),y=!1,l=0,u={data:{intl:{locales:"en-US"}}},e=o("#tmpl-story").textContent,t=o("#tmpl-story-details").textContent,s=o("#tmpl-story-details-comment").textContent;if("undefined"!=typeof HandlebarsIntl)HandlebarsIntl.registerWith(Handlebars);else{var r=/, {{ formatRelative time }}/;e=e.replace(r,""),t=t.replace(r,""),s=s.replace(r,"")}var d=Handlebars.compile(e),m=Handlebars.compile(t),f=Handlebars.compile(s);function c(e,t){var s=document.getElementById("s-"+e);if(null!==s){t.time*=1e3;var r=d(t);s.innerHTML=r,s.addEventListener("click",function(e){e.url&&(e.urlobj=new URL(e.url));var t,s,r,i,o=m(e),a=e.kids,n=f({by:"",text:"Loading comment..."});storyDetails.innerHTML=o,s=storyDetails.querySelector(".js-comments"),r=storyDetails.querySelector(".js-header"),i=storyDetails.querySelector(".js-content"),storyDetails.querySelector(".js-close").addEventListener("click",function(e){document.body.classList.remove("details-active"),storyDetails.style.opacity=0,storyDetails.classList.add("hide"),storyDetails.classList.remove("show"),y=!1}.bind(this,e.id));var l=r.getBoundingClientRect().height;if(i.style.paddingTop=l+"px",void 0===a)return;for(var d=0,c=a.length;d<c;d++)(t=document.createElement("aside")).setAttribute("id","sdc-"+a[d]),t.classList.add("story-details__comment"),t.innerHTML=n,s.appendChild(t),APP.Data.getStoryComment(a[d],function(e){e.time*=1e3;var t=s.querySelector("#sdc-"+e.id);t.innerHTML=f(e,u)});!function(e){if(y)return;y=!0;if(!storyDetails)return;document.body.classList.add("details-active"),storyDetails.style.opacity=1,storyDetails.classList.add("show"),storyDetails.classList.remove("hide")}(e.id)}.bind(this,t)),s.classList.add("clickable"),l--}0===l&&p()}function p(){for(var e=document.querySelectorAll(".story"),t=h.offsetHeight,s=[],r=e[0].getBoundingClientRect().height,i=e[0].getBoundingClientRect().top,o=Math.max(0,Math.floor(-1*i/r)),a=o+(Math.ceil(window.innerHeight/r)+5),n=o;n<a;n++)d=(l=e[n]).querySelector(".story__score"),s[n]=d.getBoundingClientRect().top;var l,d,c,y,u,m,f;for(n=o;n<a;n++)d=(l=e[n]).querySelector(".story__score"),c=l.querySelector(".story__title"),m=1-.5*(y=(s[n]-170)/t),f=(40*(u=1-.05*y)-38)/2*100,d.style.transform="scale("+u+")",d.style.backgroundColor="hsl(42, "+f+"%, 50%)",c.style.opacity=m}function v(){if(!(0<l)){for(var e,t,s=a+(l=n),r=a;r<s;r++){if(r>=i.length)return;e=String(i[r]),(t=document.createElement("div")).setAttribute("id","s-"+e),t.classList.add("story"),t.innerHTML=d({title:"...",score:"-",by:"...",time:0}),h.appendChild(t),APP.Data.getStoryById(i[r],c.bind(this,e))}a+=n,requestAnimationFrame(v)}}storyDetails=document.createElement("section"),storyDetails.classList.add("story-details"),document.body.appendChild(storyDetails),h.addEventListener("touchstart",function(e){.97<Math.random()&&e.preventDefault()},{passive:!0}),h.addEventListener("scroll",function(){var e=o("header"),t=e.querySelector(".header__title-wrapper"),s=Math.min(70,h.scrollTop),r="scale("+(1-s/300)+")";p(),e.style.height=156-s+"px",t.style.webkitTransform=r,t.style.transform=r,70<h.scrollTop?document.body.classList.add("raised"):document.body.classList.remove("raised");var i=h.scrollHeight-h.offsetHeight-300;h.scrollTop>i&&requestAnimationFrame(v)}),APP.Data.getTopStories(function(e){i=e,requestAnimationFrame(v),h.classList.remove("loading")})}();