APP.Main=function(){var o=300,m=document.querySelector.bind(document),r=null,l=0,a=100,y=m("main"),f=!1,s=0,g={data:{intl:{locales:"en-US"}}},e=m("#tmpl-story").textContent,t=m("#tmpl-story-details").textContent,n=m("#tmpl-story-details-comment").textContent;if("undefined"!=typeof HandlebarsIntl)HandlebarsIntl.registerWith(Handlebars);else{var i=/, {{ formatRelative time }}/;e=e.replace(i,""),t=t.replace(i,""),n=n.replace(i,"")}var d=Handlebars.compile(e),p=Handlebars.compile(t),v=Handlebars.compile(n);function c(e,t){var n=document.getElementById("s-"+e);if(null!==n){t.time*=1e3;var i=d(t);n.innerHTML=i,n.addEventListener("click",function(e){var t=m("sd-"+e.id);if(setTimeout(function(e){if(!f){f=!0;var n=m("#sd-"+e),i=null;n&&(document.body.classList.add("details-active"),n.style.opacity=1,window.requestAnimationFrame(function e(){var t=n.getBoundingClientRect();null===i&&(i=t.left),i+=.1*(0-t.left),.5<Math.abs(i)?window.requestAnimationFrame(e):i=0,n.style.left=i+"px"}))}}.bind(this,e.id),60),!t){var n,i,r,o;e.url&&(e.urlobj=new URL(e.url));var l=p(e),a=e.kids,s=v({by:"",text:"Loading comment..."});(t=document.createElement("section")).setAttribute("id","sd-"+e.id),t.classList.add("story-details"),t.innerHTML=l,document.body.appendChild(t),i=t.querySelector(".js-comments"),r=t.querySelector(".js-header"),o=t.querySelector(".js-content");var d=t.querySelector(".js-close");d.addEventListener("click",function(e){if(!f)return;var t=m("#sd-"+e),n=0;document.body.classList.remove("details-active"),t.style.opacity=0;var i=y.getBoundingClientRect(),r=(t.getBoundingClientRect(),i.width+100);window.requestAnimationFrame(function e(){n+=.1*(r-n);.5<Math.abs(n-r)?window.requestAnimationFrame(e):(n=r,f=!1);t.style.left=n+"px"})}.bind(this,e.id));var c=r.getBoundingClientRect().height;if(o.style.paddingTop=c+"px",void 0===a)return;for(var u=0;u<a.length;u++)(n=document.createElement("aside")).setAttribute("id","sdc-"+a[u]),n.classList.add("story-details__comment"),n.innerHTML=s,i.appendChild(n),APP.Data.getStoryComment(a[u],function(e){e.time*=1e3;var t=i.querySelector("#sdc-"+e.id);t.innerHTML=v(e,g)})}}.bind(this,t)),n.classList.add("clickable"),s--}0===s&&u()}function u(){for(var e=document.querySelectorAll(".story"),t=0;t<e.length;t++){var n=e[t],i=n.querySelector(".story__score"),r=n.querySelector(".story__title"),o=y.offsetHeight,l=(y.getBoundingClientRect(),i.getBoundingClientRect().top-document.body.getBoundingClientRect().top),a=Math.min(1,1-(l-170)/o*.05),s=Math.min(1,1-(l-170)/o*.5);i.style.width=40*a+"px",i.style.height=40*a+"px",i.style.lineHeight=40*a+"px";var d=((l=i.getBoundingClientRect()).width-38)/2*100;i.style.backgroundColor="hsl(42, "+d+"%, 50%)",r.style.opacity=s}}function h(){if(!(0<s)){for(var e=l+(s=a),t=l;t<e;t++){if(t>=r.length)return;var n=String(r[t]),i=document.createElement("div");i.setAttribute("id","s-"+n),i.classList.add("story"),i.innerHTML=d({title:"...",score:"-",by:"...",time:0}),y.appendChild(i),APP.Data.getStoryById(r[t],c.bind(this,n))}l+=a}}y.addEventListener("scroll",function(){var e=m("header"),t=e.querySelector(".header__title-wrapper"),n=Math.min(70,y.scrollTop),i="scale("+(1-n/300)+")";u(),e.style.height=156-n+"px",t.style.webkitTransform=i,t.style.transform=i,70<y.scrollTop?document.body.classList.add("raised"):document.body.classList.remove("raised");var r=y.scrollHeight-y.offsetHeight-o;y.scrollTop>r&&h()}),APP.Data.getTopStories(function(e){r=e,h(),y.classList.remove("loading")})}();