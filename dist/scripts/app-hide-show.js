APP.Main=function(){var o=300,u=document.querySelector.bind(document),r=null,n=0,a=100,c=u("main"),y=!1,l=0,h={data:{intl:{locales:"en-US"}}},e=u("#tmpl-story").textContent,t=u("#tmpl-story-details").textContent,i=u("#tmpl-story-details-comment").textContent;if("undefined"!=typeof HandlebarsIntl)HandlebarsIntl.registerWith(Handlebars);else{var s=/, {{ formatRelative time }}/;e=e.replace(s,""),t=t.replace(s,""),i=i.replace(s,"")}var d=Handlebars.compile(e),p=Handlebars.compile(t),f=Handlebars.compile(i);function m(e,t){var i=document.getElementById("s-"+e);if(null!==i){t.time*=1e3;var s=d(t);i.innerHTML=s,i.addEventListener("click",function(e){var t=u("sd-"+e.id);if(setTimeout(function(e){if(!y){y=!0;var t=u("#sd-"+e);t&&(document.body.classList.add("details-active"),t.style.opacity=1,t.classList.add("show"),t.classList.remove("hide"))}}.bind(this,e.id),60),!t){var i,s,r,n;e.url&&(e.urlobj=new URL(e.url));var o=p(e),a=e.kids,l=f({by:"",text:"Loading comment..."});(t=document.createElement("section")).setAttribute("id","sd-"+e.id),t.classList.add("story-details"),t.innerHTML=o,document.body.appendChild(t),s=t.querySelector(".js-comments"),r=t.querySelector(".js-header"),n=t.querySelector(".js-content");var d=t.querySelector(".js-close");d.addEventListener("click",function(e){storyDetails.classList.add("hide"),storyDetails.classList.remove("show")}.bind(this,e.id));var c=r.getBoundingClientRect().height;if(n.style.paddingTop=c+"px",void 0===a)return;for(var m=0;m<a.length;m++)(i=document.createElement("aside")).setAttribute("id","sdc-"+a[m]),i.classList.add("story-details__comment"),i.innerHTML=l,s.appendChild(i),APP.Data.getStoryComment(a[m],function(e){e.time*=1e3;var t=s.querySelector("#sdc-"+e.id);t.innerHTML=f(e,h)})}}.bind(this,t)),i.classList.add("clickable"),l--}0===l&&g()}function g(){for(var e=document.querySelectorAll(".story"),t=0;t<e.length;t++){var i=e[t],s=i.querySelector(".story__score"),r=i.querySelector(".story__title"),n=c.offsetHeight,o=(c.getBoundingClientRect(),s.getBoundingClientRect().top-document.body.getBoundingClientRect().top),a=Math.min(1,1-(o-170)/n*.05),l=Math.min(1,1-(o-170)/n*.5);s.style.width=40*a+"px",s.style.height=40*a+"px",s.style.lineHeight=40*a+"px";var d=((o=s.getBoundingClientRect()).width-38)/2*100;s.style.backgroundColor="hsl(42, "+d+"%, 50%)",r.style.opacity=l}}var v=-1;function b(){if(!(0<l)){for(var e=n+(l=a),t=n;t<e;t++){if(t>=r.length)return;var i=String(r[t]),s=document.createElement("div");s.setAttribute("id","s-"+i),s.classList.add("story"),s.innerHTML=d({title:"...",score:"-",by:"...",time:0}),c.appendChild(s),APP.Data.getStoryById(r[t],m.bind(this,i))}n+=a}}c.addEventListener("scroll",function e(){if(v==window.pageYOffset)return window.requestAnimationFrame(e),!1;v=window.pageYOffset;var t=(r=u("header")).querySelector(".header__title-wrapper"),i="scale("+(1-(n=Math.min(70,c.scrollTop))/300)+")";g(),r.style.height=156-n+"px",t.style.webkitTransform=i,t.style.transform=i,70<c.scrollTop?document.body.classList.add("raised"):document.body.classList.remove("raised");var s=c.scrollHeight-c.offsetHeight-o;c.scrollTop>s&&b();var r,n;t=(r=u("header")).querySelector(".header__title-wrapper"),i="scale("+(1-(n=Math.min(70,c.scrollTop))/300)+")";r.style.height=156-n+"px",t.style.webkitTransform=i,t.style.transform=i,70<c.scrollTop?document.body.classList.add("raised"):document.body.classList.remove("raised");s=c.scrollHeight-c.offsetHeight-o;c.scrollTop>s&&b(),window.requestAnimationFrame(e)}),APP.Data.getTopStories(function(e){r=e,b(),c.classList.remove("loading")})}();